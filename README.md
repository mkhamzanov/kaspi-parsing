# üõí Kaspi.kz Parser

<div align="center">

![Python](https://img.shields.io/badge/Python-3.11+-3776AB?style=for-the-badge&logo=python&logoColor=white)
![Jupyter](https://img.shields.io/badge/Jupyter-Notebook-F37626?style=for-the-badge&logo=jupyter&logoColor=white)
![ClickHouse](https://img.shields.io/badge/ClickHouse-Database-FFCC01?style=for-the-badge&logo=clickhouse&logoColor=black)
![Pandas](https://img.shields.io/badge/Pandas-Data_Analysis-150458?style=for-the-badge&logo=pandas&logoColor=white)
![License](https://img.shields.io/badge/License-MIT-green?style=for-the-badge)

**üá∞üáø –ü–∞—Ä—Å–µ—Ä –¥–∞–Ω–Ω—ã—Ö —Å –∫—Ä—É–ø–Ω–µ–π—à–µ–≥–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞**

[–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞) ‚Ä¢ [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ) ‚Ä¢ [–°—Ç—Ä—É–∫—Ç—É—Ä–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞) ‚Ä¢ [–°–∫—Ä–∏–ø—Ç—ã](#-—Å–∫—Ä–∏–ø—Ç—ã)

</div>

---

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è **—Å–±–æ—Ä–∞ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ [Kaspi.kz](https://kaspi.kz) ‚Äî –∫—Ä—É–ø–Ω–µ–π—à–µ–π —Ç–æ—Ä–≥–æ–≤–æ–π –ø–ª–æ—â–∞–¥–∫–∏ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞.

–î–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ **ClickHouse** –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

### ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

| –§—É–Ω–∫—Ü–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
| üì¶ **–°–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π** | –í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ |
| üóÑÔ∏è **ClickHouse** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö |
| üîÑ **–†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –æ–±—Ö–æ–¥** | –ü–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –ª—é–±–æ–π –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ |
| üìà **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤, –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| üêç **Jupyter Notebooks** | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ |

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone git@github.com:mkhamzanov/kaspi-parsing.git
cd kaspi-parsing
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/MacOS
source venv/bin/activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞

–°–∫–æ–ø–∏—Ä—É–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ –∏ –∑–∞–ø–æ–ª–Ω–∏ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:

```bash
cp config.example.json config.json
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π `config.json`:

```json
{
  "clickhouse": {
    "CH_HOST": "your-clickhouse-host",
    "CH_PORT": 8123,
    "CH_USER": "your-user",
    "CH_PASS": "your-password",
    "CH_DB": "kaspi",
    "CH_TABLE": "categories",
    "CH_BATCH_ROWS": 500000,
    "CH_HTTP_TIMEOUT": 600
  }
}
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –§–∞–π–ª `config.json` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `.gitignore` –∏ –Ω–µ –ø–æ–ø–∞–¥—ë—Ç –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!

### 5. –ó–∞–ø—É—Å–∫ Jupyter

```bash
jupyter notebook
```

–ò–ª–∏ –≤—ã–±–µ—Ä–∏ kernel `venv` –≤ VSCode.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kaspi-parsing/
‚îú‚îÄ‚îÄ üìì kaspi_categories.ipynb    # –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ—É—Ç–±—É–∫ –¥–ª—è —Å–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îú‚îÄ‚îÄ üêç kaspi_all_categories.py   # CLI —Å–∫—Ä–∏–ø—Ç
‚îú‚îÄ‚îÄ ‚öôÔ∏è config.example.json       # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥–∞ (–±–µ–∑ –∫—Ä–µ–¥–æ–≤)
‚îú‚îÄ‚îÄ üîí config.json               # –¢–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ (–≤ .gitignore)
‚îú‚îÄ‚îÄ üìã requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ üö´ .gitignore                # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îî‚îÄ‚îÄ üìñ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

---

## üìú –°–∫—Ä–∏–ø—Ç—ã

### üìì `kaspi_categories.ipynb`

> **Jupyter Notebook –¥–ª—è —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π Kaspi.kz –∏ –∑–∞–ø–∏—Å–∏ –≤ ClickHouse**

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:

| –®–∞–≥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----|----------|
| 1Ô∏è‚É£ | –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥ –∏–∑ `config.json` |
| 2Ô∏è‚É£ | –ü–æ–ª—É—á–∞–µ—Ç **20 –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π** (–û–¥–µ–∂–¥–∞, –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞, –ú–µ–±–µ–ª—å –∏ —Ç.–¥.) |
| 3Ô∏è‚É£ | –ü–æ –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç **–¥–µ—Ä–µ–≤–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π** |
| 4Ô∏è‚É£ | **–†–µ–∫—É—Ä—Å–∏–≤–Ω–æ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç** –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ |
| 5Ô∏è‚É£ | –°–æ–±–∏—Ä–∞–µ—Ç –≤—Å—ë –≤ **–µ–¥–∏–Ω—ã–π DataFrame** |
| 6Ô∏è‚É£ | **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤ ClickHouse** —á–µ—Ä–µ–∑ HTTP API |

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö:

```
üìä –ò—Ç–æ–≥–æ–≤—ã–π –¥–∞—Ç–∞—Å–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
‚îú‚îÄ‚îÄ main_category_code    ‚Äî –∫–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (Fashion, Computers...)
‚îú‚îÄ‚îÄ main_category_title   ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ id                    ‚Äî ID –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ title                 ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ title_ru              ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º
‚îú‚îÄ‚îÄ link                  ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
‚îú‚îÄ‚îÄ count                 ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ popularity            ‚Äî –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ parent_id             ‚Äî ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îú‚îÄ‚îÄ parent_title          ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
‚îî‚îÄ‚îÄ level                 ‚Äî —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ (0, 1, 2...)
```

#### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
[1/20] –¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ –∏ –¥–∞—á–∏ (Home)... OK (156 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
[2/20] –ö—Ä–∞—Å–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ (Beauty care)... OK (89 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
[3/20] –û–¥–µ–∂–¥–∞ (Fashion)... OK (99 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π)
...
–ì–æ—Ç–æ–≤–æ! –°–æ–±—Ä–∞–Ω–æ 1247 –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π
–ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ ClickHouse kaspi.categories...
–£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–æ 1247 —Å—Ç—Ä–æ–∫ –≤ ClickHouse!
```

---

## üóÑÔ∏è ClickHouse

### –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü—ã `kaspi.categories`

```sql
CREATE TABLE kaspi.categories (
    main_category_code String,
    main_category_title String,
    id String,
    title String,
    title_ru String,
    link String,
    active Bool,
    count Int64,
    popularity Int64,
    expanded Bool,
    parent_id String,
    parent_title String,
    level Int32
) ENGINE = MergeTree()
ORDER BY (main_category_code, id);
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–ø–∏—Å—å

```
DataFrame ‚Üí to_dict() ‚Üí JSON —Å—Ç—Ä–æ–∫–∏ ‚Üí HTTP POST ‚Üí ClickHouse
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ Kaspi.kz

| # | –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–¥ | –¢–æ–≤–∞—Ä–æ–≤ |
|---|-----------|-----|---------|
| 1 | üè† –¢–æ–≤–∞—Ä—ã –¥–ª—è –¥–æ–º–∞ –∏ –¥–∞—á–∏ | Home | 2.5M+ |
| 2 | üíÑ –ö—Ä–∞—Å–æ—Ç–∞, –∑–¥–æ—Ä–æ–≤—å–µ | Beauty care | 2.1M+ |
| 3 | üëó –û–¥–µ–∂–¥–∞ | Fashion | 1.5M+ |
| 4 | üë∂ –î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã | Child goods | 970K+ |
| 5 | üíä –ê–ø—Ç–µ–∫–∞ | Pharmacy | 730K+ |
| 6 | üéÅ –ü–æ–¥–∞—Ä–∫–∏ | Gifts and party supplies | 700K+ |
| 7 | üîß –°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Ä–µ–º–æ–Ω—Ç | Construction and repair | 630K+ |
| 8 | üëú –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã | Fashion accessories | 630K+ |
| 9 | üèÉ –°–ø–æ—Ä—Ç, —Ç—É—Ä–∏–∑–º | Sports and outdoors | 530K+ |
| 10 | üöó –ê–≤—Ç–æ—Ç–æ–≤–∞—Ä—ã | Car goods | 520K+ |

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|------------|
| **Python 3.11+** | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ |
| **Pandas** | –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ |
| **Requests** | HTTP –∑–∞–ø—Ä–æ—Å—ã |
| **ClickHouse** | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö |
| **Jupyter** | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –Ω–æ—É—Ç–±—É–∫–∏ |

---

## üîí –í–∞–∂–Ω–æ

- ‚è±Ô∏è –ú–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ **–∑–∞–¥–µ—Ä–∂–∫–∞ 0.5 —Å–µ–∫** –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- üç™ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ **headers –∏ cookies**
- üìç –î–∞–Ω–Ω—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –¥–ª—è –≥–æ—Ä–æ–¥–∞ **–ê–ª–º–∞—Ç—ã** (city=750000000)
- üîê **–ö—Ä–µ–¥—ã ClickHouse** —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `config.json` (–Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ git!)

---

## üìù TODO

- [ ] üì¶ –ü–∞—Ä—Å–∏–Ω–≥ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- [ ] üí∞ –°–±–æ—Ä —Ü–µ–Ω –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
- [ ] üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω
- [ ] üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö (Airflow/Cron)

---

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

**mkhamzanov**

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ! üéâ

---

<div align="center">

**‚≠ê –ü–æ—Å—Ç–∞–≤—å –∑–≤–µ–∑–¥—É, –µ—Å–ª–∏ –ø—Ä–æ–µ–∫—Ç –ø–æ–ª–µ–∑–µ–Ω!**

Made with ‚ù§Ô∏è in Kazakhstan üá∞üáø

</div>
